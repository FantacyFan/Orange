<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <style>

  .axis {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  </style>
</head>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var margin = {top: 20, right: 20, bottom: 70, left: 40},
    width = 600 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

// Parse the date / time
var parseDate = d3.time.format("%Y-%m").parse;

var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

var y = d3.scale.linear().range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .tickFormat(d3.time.format("%Y-%m"));

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(10);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");


var getData;
var tempData = new Array();
var roundGetter = new Array();
var roundGetter2 = new Array();
var roundGetter3 = new Array();

d3.json("orange.json", function(error, data) {
    //error checking
    if(error){
      console.log(error);
    }

  // console.log(data);

  getData = data;

  getData.forEach(function(d,i){
  var tempObj ={
          "combinations":d.combinations
      }
    // console.log(d.combinations['round']);
  tempData.push(tempObj);

    // tempData.forEach(function(d,i){
    //   var tempObj2 = {
    //     "round":d.round
    //   }
    //   roundGetter.push(tempObj2);
    //   var tmp = roundGetter[d.index].round;
    //   console.log(tmp);
    // });
  roundGetter.push(tempData[i].combinations)
  
  tempData[i].combinations.forEach(function(d,j){
    roundGetter2 = roundGetter[i][j].round;
    roundGetter3.push(roundGetter2);

  });

  });
  // console.log(roundGetter);
  // console.log(roundGetter3);
  


  var RTpairCount1 = 0;
  var RTpairCount2 = 0;
  var category = {
    "种子轮": 0,
    "天使轮":0,
    "Pre-A轮":0,
    "A轮":0,
    "A+轮":0,
    "Pre-B轮":0,
    "B轮":0,
    "B+轮":0,
    "C轮":0,
    "D轮":0,
    "E轮":0,
    "F轮-上市前":0,
    "IPO上市":0,
    "IPO上市后":0,
    "新三板":0,
    "战略投资":0,
    "不明确":0,
    "并购":0
  };
  
  var aq;
  // console.log(roundGetter3);
  for(var i=0; i<roundGetter3.length; i++){
    if(roundGetter3[i].indexOf("并购") > -1){
      roundGetter3[i]="并购";
    }
    category[roundGetter3[i]]++;
  }

  // console.log(category.种子轮);


  var data2=[];
  data2[0]=category;

  // for(var c in category){
  //   RTpair.push(c, category[c]);
  //   // console.log(c);
  // }
  console.log(data2[0]);
  var RTpair = [];
  for(foo in data2[0]){
    // console.log(foo, data2[0][foo]);
    RTpair.push(foo);
  }

  console.log(RTpair);

 
  var tmp2=[];

  x.domain(data2.map(function(d) { 
    // console.log(d);

    for(var c in category){
      tmp2.push(c);
      // console.log(c);
    }

    // console.log(tmp2);
    return tmp2; 

  }));

  var tmp3=[];
  y.domain([0, d3.max(data2, function(d) { 
    
    // console.log(d);
    for(attr in d){
      tmp3.push(d[attr]);
    }
    return tmp3; 
  })]);

  // svg.append("g")
  //     .attr("class", "x axis")
  //     .attr("transform", "translate(0," + height + ")")
  //     .call(xAxis);

  // svg.append("g")
  //     .attr("class", "y axis")
  //     .call(yAxis)
  //   .append("text")
  //     .attr("transform", "rotate(-90)")
  //     .attr("y", 6)
  //     .attr("dy", ".71em")
  //     .style("text-anchor", "end")
  //     .text("Frequency");

  // svg.selectAll(".bar")
  //     .data(data)
  //   .enter().append("rect")
  //     .attr("class", "bar")
  //     .attr("x", function(d) { 
  //       return x(tmp2); 
  //     })
  //     .attr("width", x.rangeBand())
  //     .attr("y", function(d) { 
  //       // console.log(y(tmp3));
  //       return y(tmp3); 
  //     })
  //     .attr("height", function(d) { return height - y(tmp3); });
});

// function type(data2) {
//   tmp3 = +tmp3;
//   return data2;
// }

</script>